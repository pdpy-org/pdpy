<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pdpy.classes.pdpy &mdash; pdpy  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> pdpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../classes.html">Classes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pdpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>pdpy.classes.pdpy</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pdpy.classes.pdpy</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># **************************************************************************** #</span>
<span class="c1"># This file is part of the pdpy project</span>
<span class="c1"># Copyright (C) 2021 Fede Camara Halac</span>
<span class="c1"># **************************************************************************** #</span>
<span class="sd">&quot;&quot;&quot; PdPy class definition &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">Base</span>
<span class="kn">from</span> <span class="nn">.canvasbase</span> <span class="kn">import</span> <span class="n">CanvasBase</span>
<span class="kn">from</span> <span class="nn">.default</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.point</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">.size</span> <span class="kn">import</span> <span class="n">Size</span>
<span class="kn">from</span> <span class="nn">.coords</span> <span class="kn">import</span> <span class="n">Coords</span>
<span class="kn">from</span> <span class="nn">.cnv</span> <span class="kn">import</span> <span class="n">Cnv</span>
<span class="kn">from</span> <span class="nn">.toggle</span> <span class="kn">import</span> <span class="n">Toggle</span>
<span class="kn">from</span> <span class="nn">.slider</span> <span class="kn">import</span> <span class="n">Slider</span>
<span class="kn">from</span> <span class="nn">.radio</span> <span class="kn">import</span> <span class="n">Radio</span>
<span class="kn">from</span> <span class="nn">.nbx</span> <span class="kn">import</span> <span class="n">Nbx</span>
<span class="kn">from</span> <span class="nn">.bng</span> <span class="kn">import</span> <span class="n">Bng</span>
<span class="kn">from</span> <span class="nn">.vu</span> <span class="kn">import</span> <span class="n">Vu</span>
<span class="kn">from</span> <span class="nn">.canvas</span> <span class="kn">import</span> <span class="n">Canvas</span>
<span class="kn">from</span> <span class="nn">.struct</span> <span class="kn">import</span> <span class="n">Struct</span>
<span class="kn">from</span> <span class="nn">.scalar</span> <span class="kn">import</span> <span class="n">Scalar</span>
<span class="kn">from</span> <span class="nn">.graph</span> <span class="kn">import</span> <span class="n">Graph</span>
<span class="kn">from</span> <span class="nn">.goparray</span> <span class="kn">import</span> <span class="n">GOPArray</span>
<span class="kn">from</span> <span class="nn">.data</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">from</span> <span class="nn">.obj</span> <span class="kn">import</span> <span class="n">Obj</span>
<span class="kn">from</span> <span class="nn">.array</span> <span class="kn">import</span> <span class="n">Array</span>
<span class="kn">from</span> <span class="nn">.gui</span> <span class="kn">import</span> <span class="n">Gui</span>
<span class="kn">from</span> <span class="nn">.message</span> <span class="kn">import</span> <span class="n">Msg</span>
<span class="kn">from</span> <span class="nn">.dependencies</span> <span class="kn">import</span> <span class="n">Dependencies</span>
<span class="kn">from</span> <span class="nn">.comment</span> <span class="kn">import</span> <span class="n">Comment</span>
<span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">Edge</span>
<span class="kn">from</span> <span class="nn">..util.utils</span> <span class="kn">import</span> <span class="n">log</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;PdPy&#39;</span> <span class="p">]</span>

<div class="viewcode-block" id="PdPy"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy">[docs]</a><span class="k">class</span> <span class="nc">PdPy</span><span class="p">(</span><span class="n">CanvasBase</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
  
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
               <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
               <span class="n">root</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">pd_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">json</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">xml</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">pdpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initialize a PdPy object &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">patchname</span> <span class="o">=</span> <span class="n">Base</span><span class="o">.</span><span class="n">__sane_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__pdpy__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__canvas_idx__</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__depth__</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">CanvasBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json</span><span class="p">,</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">json</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xml</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pd_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="c1"># parse the pd lines and populate the pdpy instance</span>
      <span class="c1"># account for pure data line endings and split into a list</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">pd_lines</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">isroot</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">patchname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchname</span>
    
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">):</span>
      <span class="c1"># update the parent of all childs</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__jsontree__</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">pdpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pdpath</span><span class="p">(</span><span class="n">pdpath</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">__jsontree__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># log(0, f&quot;{self.__class__.__name__}.__jsontree__()&quot;)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;__p__&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;structs&#39;</span><span class="p">,</span> <span class="p">[]):</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;__p__&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__addparents__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

<div class="viewcode-block" id="PdPy.getTemplate"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.getTemplate">[docs]</a>  <span class="k">def</span> <span class="nf">getTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;structs&#39;</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">template_name</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">idx</span><span class="p">,</span> <span class="n">s</span></div>
  
<div class="viewcode-block" id="PdPy.addStruct"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addStruct">[docs]</a>  <span class="k">def</span> <span class="nf">addStruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pd_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xml</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;structs&#39;</span><span class="p">):</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">structs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json</span><span class="p">,</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml</span><span class="p">)</span>
    <span class="n">struct</span><span class="o">.</span><span class="n">__parent__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">structs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>  </div>
  
<div class="viewcode-block" id="PdPy.addRoot"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addRoot">[docs]</a>  <span class="k">def</span> <span class="nf">addRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pd_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add a root canvas object from pure data, json, or an empty canvas </span>
<span class="sd">    </span>
<span class="sd">    Description:</span>
<span class="sd">    ------------</span>
<span class="sd">    Called by the parse() method as well as the PdPyParser class</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    The root canvas object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pd_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;screen&#39;</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
                 <span class="p">(</span><span class="s1">&#39;dimension&#39;</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">h</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">3</span><span class="p">])),</span>
                 <span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span> <span class="p">]:</span> 
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">elif</span> <span class="n">json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">json</span><span class="o">=</span><span class="n">json</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">()</span>
    
    <span class="c1"># Force these things to happen</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;__p__&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span> 
               <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> 
               <span class="p">(</span><span class="s1">&#39;isroot&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> 
               <span class="p">(</span><span class="s1">&#39;vis&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
               <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchname</span><span class="p">)</span> <span class="p">]:</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span></div>
  
<div class="viewcode-block" id="PdPy.addDependencies"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addDependencies">[docs]</a>  <span class="k">def</span> <span class="nf">addDependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; handle embedded declarations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;dependencies&quot;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span> <span class="o">=</span> <span class="n">Dependencies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Dependencies</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

  <span class="k">def</span> <span class="nf">__last_canvas__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the most recent canvas (from the nodes list)</span>

<span class="sd">    Description</span>
<span class="sd">    -----------</span>
<span class="sd">    1. Start at the root canvas</span>
<span class="sd">    2. Do `__depth__` amount of iterations (0 depth will return `self.root`)</span>
<span class="sd">    3. Get the `canvas_node_index` by indexing `__canvas_idx__` with `__depth__`</span>
<span class="sd">    4. Return the canvas located at that `canvas_node_index`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">__canvas__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__depth__</span><span class="p">):</span>
      <span class="n">canvas_node_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__canvas_idx__</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
      <span class="n">__canvas__</span> <span class="o">=</span> <span class="n">__canvas__</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">canvas_node_index</span><span class="p">]</span>
  
    <span class="k">return</span> <span class="n">__canvas__</span>
  
  <span class="k">def</span> <span class="nf">__get_canvas__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return the last canvas taking depth and incrementing object index count</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># __canvas__ = self.root if self.__depth__ == 0 else self.__last_canvas__()</span>
    <span class="n">__canvas__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span> <span class="o">=</span> <span class="n">__canvas__</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__depth__</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">__canvas__</span>

<div class="viewcode-block" id="PdPy.addCanvas"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addCanvas">[docs]</a>  <span class="k">def</span> <span class="nf">addCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pd_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add a Canvas object from pure data syntax tokens</span>
<span class="sd">    </span>
<span class="sd">    Description:</span>
<span class="sd">    ------------</span>
<span class="sd">    This </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__canvas__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_canvas__</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pd_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">json</span><span class="o">=</span><span class="p">{</span>
              <span class="s1">&#39;name&#39;</span>   <span class="p">:</span> <span class="n">pd_lines</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;vis&#39;</span>    <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__num__</span><span class="p">(</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
              <span class="s1">&#39;id&#39;</span>     <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">,</span>
              <span class="s1">&#39;screen&#39;</span> <span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> 
              <span class="s1">&#39;dimension&#39;</span> <span class="p">:</span> <span class="n">Size</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">h</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
      <span class="p">})</span>
    <span class="k">elif</span> <span class="n">json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">json</span><span class="o">=</span><span class="n">json</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__canvas_idx__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__canvas__</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">canvas</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">canvas</span></div>

<div class="viewcode-block" id="PdPy.addObj"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addObj">[docs]</a>  <span class="k">def</span> <span class="nf">addObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add a Pd object from pure data syntax tokens</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># log(1,&quot;addOBJ&quot;, argv)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
    <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
      <span class="c1"># an empty object</span>
      <span class="n">obj</span> <span class="o">=</span> <span class="n">Obj</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># protect against argv not being a list</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="n">argv</span><span class="p">]</span>
      <span class="c1"># text-group object</span>
      <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="o">==</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
      <span class="c1"># array-group object</span>
      <span class="k">elif</span> <span class="s2">&quot;array&quot;</span> <span class="o">==</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
      <span class="c1"># scalar-define object</span>
      <span class="k">elif</span> <span class="s2">&quot;scalar&quot;</span> <span class="o">==</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
      <span class="c1"># file-define object</span>
      <span class="k">elif</span> <span class="s2">&quot;file&quot;</span> <span class="o">==</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
      <span class="c1"># IEMGUI-group object</span>
      <span class="k">elif</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">IEMGuiNames</span><span class="p">:</span>
        <span class="c1"># log(1, &quot;NODES:&quot;, argv)</span>
        <span class="k">if</span> <span class="s2">&quot;vu&quot;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">Vu</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;tgl&quot;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">Toggle</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;cnv&quot;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;my_canvas&quot;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">Cnv</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;radio&quot;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;rdb&quot;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">Radio</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;bng&quot;</span>    <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">Bng</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;nbx&quot;</span>    <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">Nbx</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;sl&quot;</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
          <span class="n">obj</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown class name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="p">))</span>
      
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
      <span class="c1"># TODO: make special cases for data structures</span>
      <span class="c1"># - drawing instructions</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Obj</span><span class="p">(</span><span class="n">pd_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>
  
<div class="viewcode-block" id="PdPy.addMsg"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addMsg">[docs]</a>  <span class="k">def</span> <span class="nf">addMsg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="c1"># log(1,&quot;msg&quot;, nodes)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">]</span><span class="o">+</span><span class="n">argv</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">msg</span></div>
  
<div class="viewcode-block" id="PdPy.addComment"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addComment">[docs]</a>  <span class="k">def</span> <span class="nf">addComment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
    <span class="c1"># log(1,&quot;COMMENT&quot;,argv)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="n">argv</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">comment</span></div>

<div class="viewcode-block" id="PdPy.addNativeGui"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addNativeGui">[docs]</a>  <span class="k">def</span> <span class="nf">addNativeGui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">className</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Gui</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="p">[</span> <span class="n">className</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span> <span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="PdPy.addGraph"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addGraph">[docs]</a>  <span class="k">def</span> <span class="nf">addGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The ye-olde array ancestor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span></div>

<div class="viewcode-block" id="PdPy.addGOPArray"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addGOPArray">[docs]</a>  <span class="k">def</span> <span class="nf">addGOPArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="c1"># log(1,&quot;addGOPArray&quot;, argv)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">GOPArray</span><span class="p">(</span><span class="n">json</span><span class="o">=</span><span class="p">{</span>
      <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
      <span class="s1">&#39;length&#39;</span> <span class="p">:</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
      <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
      <span class="s1">&#39;flag&#39;</span> <span class="p">:</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
      <span class="s1">&#39;className&#39;</span> <span class="p">:</span> <span class="s2">&quot;goparray&quot;</span>
    <span class="p">},</span> <span class="bp">cls</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span></div>
  
<div class="viewcode-block" id="PdPy.addScalar"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addScalar">[docs]</a>  <span class="k">def</span> <span class="nf">addScalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pd_lines</span><span class="p">):</span>
    <span class="n">scalar</span> <span class="o">=</span> <span class="n">Scalar</span><span class="p">(</span><span class="n">struct</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structs</span><span class="p">,</span> <span class="n">pd_lines</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scalar</span></div>

<div class="viewcode-block" id="PdPy.addEdge"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addEdge">[docs]</a>  <span class="k">def</span> <span class="nf">addEdge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pd_lines</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="n">pd_lines</span><span class="p">))</span></div>

<div class="viewcode-block" id="PdPy.addCoords"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.addCoords">[docs]</a>  <span class="k">def</span> <span class="nf">addCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; the coords constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">(),</span> <span class="s2">&quot;coords&quot;</span><span class="p">,</span> <span class="n">Coords</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">))</span></div>

<div class="viewcode-block" id="PdPy.restore"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.restore">[docs]</a>  <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Restore constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># restored canvases also have borders</span>
    <span class="c1"># log(0,&quot;RESTORE&quot;,argv)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">(),</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__depth__</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__canvas_idx__</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__canvas_idx__</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">last</span></div>

<div class="viewcode-block" id="PdPy.create"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.create">[docs]</a>  <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">anything</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create an object, message, comment, or any other pd object &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">anything</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__obj_idx__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
      <span class="n">__last_canvas__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span>
      <span class="n">__obj_id__</span> <span class="o">=</span> <span class="n">__last_canvas__</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
      <span class="n">a</span><span class="o">.</span><span class="n">__parent__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">__last_canvas__</span><span class="p">)</span>
      <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">__obj_id__</span>
    <span class="k">return</span> <span class="bp">self</span></div>

  <span class="k">def</span> <span class="nf">__add_xy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
      <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">]</span>
    
    <span class="n">max_width</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_height</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
      <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">__get_obj_size__</span><span class="p">()</span>
      <span class="n">canvas</span><span class="o">.</span><span class="n">update_cursor</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
      <span class="c1"># if width &gt;= max_width:</span>
      <span class="c1">#   max_width = width</span>
      <span class="c1"># if height &gt;= max_height:</span>
      <span class="c1">#   max_height = height</span>
      <span class="c1"># canvas.update_cursor(width=max_width, height=max_height)</span>
      <span class="n">node</span><span class="o">.</span><span class="n">addpos</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">__cursor__</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">canvas</span><span class="o">.</span><span class="n">__cursor__</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>


<div class="viewcode-block" id="PdPy.arrange"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.arrange">[docs]</a>  <span class="k">def</span> <span class="nf">arrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">__last_canvas__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sinks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">__last_canvas__</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
      <span class="n">src</span> <span class="o">=</span> <span class="n">__last_canvas__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
      <span class="n">snk</span> <span class="o">=</span> <span class="n">__last_canvas__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">sink</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
      <span class="n">edges</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">src</span><span class="p">,</span><span class="n">snk</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">src</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span> 
        <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">snk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sinks</span><span class="p">:</span> 
        <span class="n">sinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snk</span><span class="p">)</span>

    <span class="n">unconnected</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">__last_canvas__</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sources</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sinks</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unconnected</span><span class="p">:</span>
        <span class="n">unconnected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__last_canvas__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__add_xy__</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">__last_canvas__</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">unconnected</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__add_xy__</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">__last_canvas__</span><span class="p">)</span></div>
      

<div class="viewcode-block" id="PdPy.write"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.write">[docs]</a>  <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Write out the pd file to disk &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">arrange</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchname</span> <span class="o">+</span> <span class="s1">&#39;.pd&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">patchfile</span><span class="p">:</span>
      <span class="k">if</span> <span class="s1">&#39;.pd&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">patchfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pd__</span><span class="p">())</span>
      <span class="k">elif</span> <span class="s1">&#39;.json&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">patchfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__json__</span><span class="p">())</span></div>
  
<div class="viewcode-block" id="PdPy.connect"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.connect">[docs]</a>  <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">argv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attempt to autoconnect the objects together &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    
    <span class="n">stepsize</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span>
    
    <span class="c1"># utility routine </span>
    <span class="k">def</span> <span class="nf">_connect</span><span class="p">(</span><span class="o">*</span><span class="n">argv</span><span class="p">):</span>
      <span class="n">e</span> <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="n">argv</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__last_canvas__</span><span class="p">()</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">):</span>
      <span class="n">src</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># the source</span>
      <span class="n">snk</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># the sink</span>
      <span class="c1"># check if we are lists</span>
      <span class="n">srclist</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
      <span class="n">snklist</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">snk</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
      <span class="c1"># neither is a list</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">srclist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">snklist</span><span class="p">:</span>
        <span class="n">_connect</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">snk</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="c1"># only sink is a list (connect sequentially to multiple inlets)</span>
      <span class="k">elif</span> <span class="ow">not</span> <span class="n">srclist</span> <span class="ow">and</span> <span class="n">snklist</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">snk</span><span class="p">)):</span>
          <span class="n">_connect</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">snk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">snk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="c1"># only source is a list (connect sequentially from multiple outlets)</span>
      <span class="k">elif</span> <span class="n">srclist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">snklist</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">)):</span>
          <span class="n">_connect</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">snk</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
      <span class="c1"># both are lists (limit to minimum iolets between source and sink), so</span>
      <span class="c1"># connect([source, 0, 1, 2], [sink, 1, 2]) gives</span>
      <span class="c1"># #X connect source.id 0 sink.id 1</span>
      <span class="c1"># #X connect source.id 1 sink.id 2 </span>
      <span class="k">elif</span> <span class="n">srclist</span> <span class="ow">and</span> <span class="n">snklist</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">snk</span><span class="p">))):</span>
          <span class="n">_connect</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">snk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">snk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>
  
    

<div class="viewcode-block" id="PdPy.parse"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.parse">[docs]</a>  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argvecs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse a list of Pd argument vectors (1) into this instance&#39;s scope</span>

<span class="sd">    Description:</span>
<span class="sd">    ------------</span>
<span class="sd">    This method populates the current class with appropriate calls to </span>
<span class="sd">    individual classes refered to by parsing the argument vector `argv`.</span>

<span class="sd">    (1) A pure data argument vector is a list containing a tokenized version</span>
<span class="sd">    of the pure data file line (binbuf), starting with &#39;#&#39; and ending with &#39;;&#39;.</span>
<span class="sd">    The tokens are split by spaces, ignoring escaped chars. The special char</span>
<span class="sd">    &#39;,&#39; is handled before calling this method.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># log(1,f&#39;Parsing {len(argvecs)} pd_lines&#39;)</span>
    <span class="c1"># print(type(argvecs))</span>
    <span class="n">store_graph</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">argv</span> <span class="ow">in</span> <span class="n">argvecs</span><span class="p">:</span>
      <span class="c1"># log(1, &quot;argv:&quot;, argv)</span>
      <span class="n">head</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> 
      <span class="n">body</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
      <span class="c1"># log(1, &quot;head:&quot;, head, &quot;body:&quot;, body)</span>
      
      
      <span class="k">if</span> <span class="s2">&quot;#N&quot;</span>   <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1">#N -&gt; either structs or canvases</span>
        <span class="k">if</span> <span class="s2">&quot;struct&quot;</span> <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addStruct</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="c1"># struct element</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># check if we are root or canvas node</span>
          <span class="k">if</span>    <span class="mi">7</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addRoot</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
          <span class="k">elif</span>  <span class="mi">8</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addCanvas</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
      <span class="k">elif</span> <span class="s2">&quot;#A&quot;</span> <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1">#A -&gt; text, savestate, or array  data</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__setdata__</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">Data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">head</span><span class="o">=</span><span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="k">else</span><span class="p">:</span> <span class="c1">#X -----------------&gt; anything else is an &quot;#X&quot;</span>
        <span class="k">if</span>   <span class="s2">&quot;declare&quot;</span>    <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addDependencies</span><span class="p">(</span><span class="n">pd_lines</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;coords&quot;</span>     <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addCoords</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;connect&quot;</span>    <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addEdge</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="c1"># edges</span>
        <span class="k">elif</span> <span class="s2">&quot;floatatom&quot;</span>  <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNativeGui</span><span class="p">(</span><span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;symbolatom&quot;</span> <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNativeGui</span><span class="p">(</span><span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;listbox&quot;</span>    <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNativeGui</span><span class="p">(</span><span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;scalar&quot;</span>     <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addScalar</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;text&quot;</span>       <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addComment</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;msg&quot;</span>        <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addMsg</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;obj&quot;</span>        <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addObj</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;pop&quot;</span>        <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">store_graph</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># pop the array old</span>
        <span class="k">elif</span> <span class="s2">&quot;f&quot;</span>          <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="s2">&quot;border&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="s2">&quot;graph&quot;</span>      <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> 
          <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addGraph</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
          <span class="n">store_graph</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="s2">&quot;array&quot;</span>      <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="c1"># fill; check if we are in a graph</span>
          <span class="k">if</span> <span class="n">store_graph</span><span class="p">:</span> <span class="n">last</span><span class="o">.</span><span class="n">addArray</span><span class="p">(</span><span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">body</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addGOPArray</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;restore&quot;</span>    <span class="o">==</span> <span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="c1">#TODO do something to graph restore...?</span>
          <span class="k">if</span> <span class="s2">&quot;graph&quot;</span> <span class="o">==</span> <span class="n">body</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>                   <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;What is this?&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchname</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">__pd__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unparse this instance&#39;s scope into a list of pure data argument vectors</span>

<span class="sd">    Description:</span>
<span class="sd">    ------------</span>
<span class="sd">    This method returns a list of pure data argument vectors (1) from this </span>
<span class="sd">    class&#39; scope.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;structs&#39;</span><span class="p">,</span> <span class="p">[]):</span>
      <span class="n">s</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">__pd__</span><span class="p">()</span>
    
    <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">__pd__</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dependencies&#39;</span><span class="p">):</span>
      <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">__pd__</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__render__</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__xml__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return the XML Element for this object &quot;&quot;&quot;</span>
    
    <span class="c1"># root tag to which struct, &#39;root&#39;, and dependencies will be added</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__element__</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> 
      <span class="s2">&quot;xml:space&quot;</span><span class="p">:</span> <span class="s2">&quot;preserve&quot;</span>
      <span class="p">})</span>
    
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;structs&#39;</span><span class="p">):</span>
      <span class="n">structs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__element__</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s2">&quot;structs&quot;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;structs&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__subelement__</span><span class="p">(</span><span class="n">structs</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">__xml__</span><span class="p">())</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__subelement__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">structs</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dependencies&#39;</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__subelement__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">__xml__</span><span class="p">())</span>
    
    <span class="c1"># make the &#39;root&#39; tag to which all other elements will be added</span>
    <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">__xml__</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
    <span class="c1"># add the &#39;root&#39; tag to the xml root</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__subelement__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
    
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__xml_nodes__</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__xml_comments__</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;coords&#39;</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__subelement__</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">__xml__</span><span class="p">())</span>
    
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__xml_edges__</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__subelement__</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">__xml__</span><span class="p">())</span>
    
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__subelement__</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__tree__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="PdPy.pdpath"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.pdpath">[docs]</a>  <span class="k">def</span> <span class="nf">pdpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_pd</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
    <span class="n">pdpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_to_pd</span><span class="p">)</span>
    <span class="n">apps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pdpath</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;Pd*.app&quot;</span><span class="p">))]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">apps</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">pdbinpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">apps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;/Contents/Resources/bin/pd&quot;</span><span class="p">)</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdbin&#39;</span><span class="p">,</span> <span class="n">pdbinpath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Could not find pd in &quot;</span> <span class="o">+</span> <span class="n">path_to_pd</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="PdPy.run"><a class="viewcode-back" href="../../../base.html#pdpy.classes.pdpy.PdPy.run">[docs]</a>  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">run</span> <span class="k">as</span> <span class="n">__run__</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;patchname&#39;</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No patchname found&quot;</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pdbin</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span>
      <span class="s2">&quot;-open&quot;</span><span class="p">,</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">patchname</span><span class="o">+</span><span class="s2">&quot;.pd&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">__run__</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


  
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Fede Camara Halac.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>